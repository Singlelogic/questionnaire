# Questionnaire REST API

REST API для проведения опросов.
***
### Функционал для администратора системы:
#### Авторизация в системе
- Для авторизации в системе отправляем POST запрос
```
http://127.0.0.1:8000/auth/login/
```
Тело запроса должно содержать email и пароль.<br>
Информация должна передаваться в формате JSON.
```
{
    "email": "example@gmail.com",
    "password": "12345678"
}
```
В ответ получаем токен доступа.<br>
```
{
    "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpZCI6MSwiZXhwIjoxNjExMDU3NTcyfQ.AtYi78E7YhjhNF1GJBE6YVv9vp"
}
```
Далее для доступа к ресурсам системы с правами администратора, в заголовок Authorization запроса добавляем данный токен (bearer token).
***
#### Создание, чтение, изменение и удаление опросов
- Создание и чтение опросов (POST, GET запрос соответственно)
```
http://127.0.0.1:8000/api/questionnaire/
```
Тело запроса должно содержать:
```
1. title - название опроса (строка макс. 50 символов)
2. description - описание опроса (неограниченная строка)
3. date_start - дата старта опроса (формат даты ГГГГ-ММ-ДД)
4. date_stop - дата окончания опроса (формат даты ГГГГ-ММ-ДД)
```
###### Примечание: Поля date_start и date_stop необязательны, можно заполнить позже, без указания даты, опрос будет считаться не активным.
###### Примечание: После указания даты старта нельзя, добавлять, измененять и удалять вопросы в опросе.
- Изменение и удаление опросов (PATCH, DELETE запрос соответственно)
```
http://127.0.0.1:8000/api/questionnaire/int:pk/
```
###### int:pk - ID опроса
***
#### Создание, чтение, изменение и удаление вопросов
- Создание и чтение вопросов к опросам (POST, GET запрос соответственно)
```
http://127.0.0.1:8000/api/question/
```
Тело запроса должно содержать:
```
1. question - описание вопроса (неограниченная строка)
2. type - указание типа вопроса (числовое значение от 1 до 3, обозначение см. ниже)
3. questionnaire_id - ID опроса
```
Тип вопроса:
1. Ответ текстом.
2. Ответ с выбором одного варианта.
3. Ответ с выбором нескольких вариантов.

- Изменение и удаление опросов (PATCH, DELETE запрос соответственно)
```
http://127.0.0.1:8000/api/question/int:pk/
```
###### int:pk - ID вопроса
***
#### Создание, чтение, изменение и удаление вариантов ответов к вопросам
- Создание и чтение вариантов ответов к вопросам (POST, GET запрос соответственно)
```
http://127.0.0.1:8000/api/answer/
```
Тело запроса должно содержать:
```
1. question_id - ID вопроса
2. text - ответ (строка макс. 500 символов)
```
###### Примечание: Данный запрос действителен только для вопросов типа 2 и 3.

- Изменение и удаление вариантов ответов (PATCH, DELETE запрос соответственно)
```
http://127.0.0.1:8000/api/answer/int:pk/
```
###### int:pk - ID ответа
***

### Функционал для пользователей системы:
- Получение списка активных опросов
```
http://127.0.0.1:8000/api/questionnaire/active/
```
- Получение списка вопросов опроса
```
http://127.0.0.1:8000/api/questionnaire/int:pk/questions/
```
###### int:pk - ID опроса
- Получение списка вариантов ответов на вопрос, если вопрос имеет тип "ответ с выбором варианта ответа"
```
http://127.0.0.1:8000/api/question/int:pk/answers/
```
###### int:pk - ID вопроса
- Прохождение опроса<br>

Опросы можно проходить анонимно, в качестве идентификатора пользователя в API передается числовой ID.<br>
Отправляем POST запрос
```
http://127.0.0.1:8000/api/answer_user/
```
Тело запроса должно содержать:
```
user_id - ID пользователя  
question - ID вопроса  
text_answer - текста ответа (если вопрос имеет тип 1)  
choice_answer - выбранный ответ из вариантов ответов (если вопрос имеет тип 2 или 3)
```
###### Примечане: Поля text_answer и choice_answer указываются в зависимости от типа вопроса, если тип вопроса не соответствует выбранному полю, запрос будет недействителен.
###### Примечане: Описние типов вопросов см. выше.<br>
Пример запороса с типом вопроса 1 (ответ текстом):
```
{
    "user_id": 1,
    "question": 2,
    "text_answer": "I like warm weather."
}
```
Пример запроса с типом вопроса 2 или 3 (ответ с выбором одного варианта, ответ с выбором нескольких вариантов):
```
{
    "user_id": 1,
    "question": 3,
    "choice_answer": [
        2
    ]
}
```
- Получение списка пройденных пользователем опросов с детализацией ответов по уникальному ID пользователя"
```
http://127.0.0.1:8000/api/answer_user/int:pk/get_user_responses
```
###### int:pk - ID опроса
***

### Для установки и проверки, открываем терминал и поочередно вводим следующие команды:
1. git clone https://github.com/Singlelogic/questionnaire.git
2. cd ./questionnaire
3. python3.8 -m venv ./venv
4. source ./venv/bin/activate
5. pip install -r requirements.txt
6. python manage.py migrate
7. python manage.py test questionnaire_api.tests
8. python manage.py createsuperuser
9. python manage.py runserver
